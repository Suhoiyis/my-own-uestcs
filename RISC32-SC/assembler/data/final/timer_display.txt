# -------------------------------------------------------------------
# 纯汇编版: Timer 读取 -> 时分秒转换 -> 数码管显示
# 对应 C 文件: timer_display.c
# -------------------------------------------------------------------

# ===================================================================
# 寄存器规划
# s0: Timer 基地址 (0x20000000)
# s1: 数码管 基地址 (0x40000000)
# s2: 常数 1000 (用于 ms -> s)
# s3: 常数 60 (用于 s -> m -> h)
# s4: 常数 10 (用于分离个位十位)
# s5: 常数 100 (用于小时取余)
# s6: 常数 3600 (用于计算总小时数)
# ===================================================================

start_kernel:
    # --- 1. 初始化基地址 ---
    lui     s0, 0x20000         # Timer Base = 0x20000000
    lui     s1, 0x40000         # SEG Base   = 0x40000000

    # --- 2. 加载小常数 ---
    addi    s2, zero, 1000      # s2 = 1000
    addi    s3, zero, 60        # s3 = 60
    addi    s4, zero, 10        # s4 = 10
    addi    s5, zero, 100       # s5 = 100

    # --- 3. 构造大常数 3600 (0xE10) ---
    # 3600 大于 2047，不能直接用 addi
    # 方法: 4096 (0x1000) - 496 = 3600
    lui     s6, 1               # s6 = 0x1000 (4096)
    addi    s6, s6, -496        # s6 = 4096 - 496 = 3600

main_loop:
    # 1. 读取毫秒数
    lw      t0, 0(s0)           # t0 = time_ms

    # 2. 计算总秒数 (total_seconds = time_ms / 1000)
    divu    t1, t0, s2          # t1 = total_seconds

    # ===============================================================
    # 处理秒 (Seconds)
    # ===============================================================
    # seconds = total_seconds % 60
    remu    t2, t1, s3          # t2 = seconds current

    # s_tens (十位) = seconds / 10
    divu    t3, t2, s4
    sb      t3, 5(s1)           # 写入 SEG_5

    # s_units (个位) = seconds % 10
    remu    t3, t2, s4
    sb      t3, 6(s1)           # 写入 SEG_6

    # ===============================================================
    # 处理分 (Minutes)
    # ===============================================================
    # total_minutes = total_seconds / 60
    divu    t2, t1, s3
    # minutes = total_minutes % 60
    remu    t2, t2, s3          # t2 = minutes current

    # m_tens = minutes / 10
    divu    t3, t2, s4
    sb      t3, 3(s1)           # 写入 SEG_3

    # m_units = minutes % 10
    remu    t3, t2, s4
    sb      t3, 4(s1)           # 写入 SEG_4

    # ===============================================================
    # 处理时 (Hours)
    # ===============================================================
    # total_hours = total_seconds / 3600
    divu    t2, t1, s6
    # hours = total_hours % 100
    remu    t2, t2, s5          # t2 = hours current

    # h_tens = hours / 10
    divu    t3, t2, s4
    sb      t3, 1(s1)           # 写入 SEG_1

    # h_units = hours % 10
    remu    t3, t2, s4
    sb      t3, 2(s1)           # 写入 SEG_2

    # 循环回去
    jal     zero, main_loop